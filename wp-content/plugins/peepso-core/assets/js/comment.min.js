!function(e,t,n){t.comment=new(function(a,m){function e(){this.init()}return m.npm.objectAssign(e.prototype,{init:function(){this.ajax={},a(a.proxy(function(){var e=(window.location.hash||"").match(/[#&]comment(?:\.|=)(\d+)\.(\d+)(?:\.(\d+)(?:\.(\d+))?)?/);e&&e[2]&&this.whenLoaded(e[1]).done(a.proxy(function(){this.reveal(e[1],e[2],e[3],e[4])},this))},this))},whenLoaded:function(o){return a.Deferred(function(e){var t,n=0;t=setInterval(function(){a(".ps-js-activity--"+o).length?(clearInterval(t),e.resolve()):60<n++&&(clearInterval(t),e.reject())},1e3)})},add:function(){},edit:function(){},reply:function(e,t,n,o){var i,r,s,c="#comment-item-"+t;s=(i=(n?a(n).closest(c):a(c)).find(".actaction-reply")).closest(".ps-comment").hasClass("ps-comment-nested")?(r=i.closest(".ps-comment").children(".ps-comment-reply")).find("textarea"):(r=i.closest(".ps-comment-item").next(".ps-comment-nested").children(".ps-comment-reply")).find("textarea"),r.not(":visible")&&r.show(),s.focus(),o=o||{},ps_observer.apply_filters("comment.reply",s,a.extend({},o,{act_id:e,post_id:t})),s.off("keyup.peepso").on("keyup.peepso",function(e){e.stopPropagation(),activity.update_beautifier(e.target)}).trigger("keyup.peepso")},show_previous:function(t,e){var i,r,s,n=".ps-js-comment-container--"+t;return i=e?a(e).closest(n):a(n),r=i.find(".ps-js-comment-more").eq(0),s=r.find(".ps-js-loading"),a.Deferred(function(e){!function(n){var o=i.children(".cstream-comment:first");s.removeClass("hidden"),m.postJson("activity.show_previous_comments",{act_id:t,uid:peepsodata.currentuserid,first:o.data("comment-id")},function(e){var t=m.observer.applyFilters("peepso_activity_content",e.data.html);t=t.replace(/\/embed\/(#\?secret=[a-zA-Z0-9]+)?"/g,'/?embed=true$1"'),s.addClass("hidden"),0==o.length?(o=i.children(".ps-comment-more")).after(t):o.before(t),0<e.data.comments_remain?r.find("a").html(e.data.comments_remain_caption):r.remove(),a(document).trigger("ps_comment_added"),n()})}(function(){e.resolve()})})},show_all:function(t){var r=a(".ps-js-comment-container--"+t),s=r.children(".ps-js-comment-more"),c=s.find(".ps-js-loading");return a.Deferred(function(e){!function n(o){var i=r.children(".cstream-comment:first");c.removeClass("hidden"),m.postJson("activity.show_previous_comments",{act_id:t,uid:peepsodata.currentuserid,all:1,first:i.data("comment-id")},function(e){var t=m.observer.applyFilters("peepso_activity_content",e.data.html);t=t.replace(/\/embed\/(#\?secret=[a-zA-Z0-9]+)?"/g,'/?embed=true$1"'),c.addClass("hidden"),0==i.length?(i=r.children(".ps-comment-more")).after(t):i.before(t),0<e.data.comments_remain?(s.find("a").html(e.data.comments_remain_caption),n(o)):(s.remove(),a(document).trigger("ps_comment_added"),o())})}(function(){e.resolve()})})},reveal_comment:function(t,n){return a.Deferred(a.proxy(function(e){a("#comment-item-"+n).length?e.resolve():this.show_all(t).done(a.proxy(function(){e.resolve()},this))},this))},reveal:function(e,t,n,o){function i(e){var t=e.find("a.ps-comment-user").eq(0).css("color"),n=e.offset().top-(a(window).height()-e.outerHeight())/2;e.css({backgroundColor:t}),e.css({transition:"background-color 2s ease"}),a("html, body").delay(50).animate({scrollTop:n},500,function(){e.css({backgroundColor:""})})}this.reveal_comment(e,t).done(a.proxy(function(){o?this.reveal_comment(n,o).done(function(){i(a("#comment-item-"+o))}):i(a("#comment-item-"+t))},this))}}),e}(e,t))}(jQuery,peepso);